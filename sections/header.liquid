{% comment %}
  Header Section
  Main navigation for the store
{% endcomment %}

<header 
  data-header
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-500 bg-gradient-to-b from-black/80 to-transparent py-6"
  style="--header-bg: {{ section.settings.background_color }};"
>
  <style>
    [data-header].scrolled {
      background: rgba({{ section.settings.background_color | color_extract: 'red' }}, {{ section.settings.background_color | color_extract: 'green' }}, {{ section.settings.background_color | color_extract: 'blue' }}, 0.9) !important;
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      padding-top: 1rem;
      padding-bottom: 1rem;
    }

    [data-mobile-menu] {
      position: fixed;
      inset: 0;
      background: rgba(5, 5, 5, 0.95);
      backdrop-filter: blur(40px);
      z-index: 40;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 2rem;
      transition: all 0.5s ease;
      opacity: 0;
      visibility: hidden;
    }

    [data-mobile-menu].active {
      display: flex;
      opacity: 1;
      visibility: visible;
    }
  </style>

  <div class="container mx-auto px-6 flex items-center justify-between">
    
    <a href="/" class="flex items-center gap-2 z-50 relative group shrink-0">
      {% if section.settings.logo != blank %}
        <img 
          src="{{ section.settings.logo | image_url: width: 100 }}" 
          alt="{{ shop.name }}"
          width="100"
          height="40"
          loading="eager"
        />
      {% else %}
        <div class="w-10 h-10 bg-brand-red flex items-center justify-center font-display text-2xl text-white tracking-tighter group-hover:shadow-[0_0_15px_rgba(208,0,0,0.6)] transition-shadow clip-path-slant">
          {{ section.settings.logo_text | default: 'RH' }}
        </div>
        <span class="font-display text-2xl tracking-wide text-white hidden md:block">
          {{ section.settings.site_name | default: shop.name | upcase }}
        </span>
      {% endif %}
    </a>

    <nav class="hidden lg:flex items-center gap-6 xl:gap-8">
      {% for link in section.settings.menu.links %}
        {% if link.links != blank %}
          <div class="relative group">
            <button class="flex items-center gap-1 text-sm font-bold text-neutral-400 hover:text-white transition-colors uppercase tracking-widest whitespace-nowrap">
              {{ link.title }}
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
            </button>
            <div class="absolute top-full left-1/2 -translate-x-1/2 w-48 pt-6 opacity-0 translate-y-4 invisible group-hover:opacity-100 group-hover:translate-y-0 group-hover:visible transition-all duration-300">
              <div class="bg-[#1a1a1a] border border-white/10 p-2 shadow-2xl rounded-sm backdrop-blur-md">
                {% for childlink in link.links %}
                  <a href="{{ childlink.url }}" class="block w-full text-left p-3 hover:bg-white/5 text-neutral-300 hover:text-white text-xs font-bold uppercase whitespace-nowrap">
                    {{ childlink.title }}
                  </a>
                {% endfor %}
              </div>
            </div>
          </div>
        {% else %}
          <a href="{{ link.url }}" class="text-sm font-bold text-neutral-400 hover:text-white transition-colors uppercase tracking-widest whitespace-nowrap">
            {{ link.title }}
          </a>
        {% endif %}
      {% endfor %}

      {% if section.settings.show_ai_lab %}
        <a 
          href="{{ section.settings.ai_lab_url }}"
          class="flex items-center gap-2 px-4 py-1.5 border border-white/20 rounded-full text-sm font-bold text-white hover:bg-white hover:text-black transition-all uppercase tracking-widest group shadow-[0_0_10px_rgba(255,255,255,0.05)] hover:shadow-[0_0_20px_rgba(255,255,255,0.3)] whitespace-nowrap"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-brand-red group-hover:text-black">
            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
            <path d="M20 3v4"></path>
            <path d="M22 5h-4"></path>
          </svg>
          {{ section.settings.ai_lab_text }}
        </a>
      {% endif %}
    </nav>

    <div class="flex items-center gap-6 z-50 relative shrink-0">
      {% if section.settings.show_search %}
        <a href="/search" class="text-white hover:text-brand-red transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.3-4.3"></path>
          </svg>
        </a>
      {% endif %}

      <a href="/cart" class="text-white hover:text-brand-red transition-colors relative">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"></path>
          <path d="M3 6h18"></path>
          <path d="M16 10a4 4 0 0 1-8 0"></path>
        </svg>
        {% if cart.item_count > 0 %}
          <span class="absolute -top-2 -right-2 w-4 h-4 bg-brand-red text-[10px] flex items-center justify-center rounded-full font-bold">
            {{ cart.item_count }}
          </span>
        {% endif %}
      </a>

      <button 
        data-mobile-menu-toggle
        class="lg:hidden text-white"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" x2="20" y1="12" y2="12"></line>
          <line x1="4" x2="20" y1="6" y2="6"></line>
          <line x1="4" x2="20" y1="18" y2="18"></line>
        </svg>
      </button>
    </div>
  </div>

  <div data-mobile-menu class="lg:hidden">
    {% for link in section.settings.menu.links %}
      <a href="{{ link.url }}" class="font-display text-4xl text-white hover:text-brand-red uppercase">
        {{ link.title }}
      </a>
      {% if link.links != blank %}
        {% for childlink in link.links %}
          <a href="{{ childlink.url }}" class="font-display text-2xl text-neutral-400 hover:text-white uppercase">
            {{ childlink.title }}
          </a>
        {% endfor %}
      {% endif %}
    {% endfor %}
  </div>
</header>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image"
    },
    {
      "type": "text",
      "id": "logo_text",
      "label": "Logo Text",
      "default": "RH",
      "info": "Used if no logo image is uploaded"
    },
    {
      "type": "text",
      "id": "site_name",
      "label": "Site Name",
      "default": "RICH HABITS"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color (when scrolled)",
      "default": "#050505"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show Search Icon",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_ai_lab",
      "label": "Show AI Lab Button",
      "default": true
    },
    {
      "type": "text",
      "id": "ai_lab_text",
      "label": "AI Lab Button Text",
      "default": "AI Gear Lab"
    },
    {
      "type": "url",
      "id": "ai_lab_url",
      "label": "AI Lab URL",
      "default": "/pages/ai-gear-lab"
    }
  ]
}
{% endschema %}
